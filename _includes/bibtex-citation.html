{% include base_path %}

<section class="page__bibtex">
  <h3 class="page__bibtex-title">Cite This Post</h3>
  
  <div class="bibtex-box">
    <pre><code>@article{&#123;{{ page.author | slugify | default: "author" }}-{{ page.title | slugify }},
  title = &#123;{{ page.title }}&#125;,
  author = &#123;{{ page.author | default: "Anonymous" }}&#125;,
  year = &#123;{{ page.date | date: "%Y" }}&#125;,
  month = &#123;{{ page.date | date: "%b" }}&#125;,
  url = &#123;{{ base_path }}{{ page.url }}&#125;,
  note = &#123;Blog post&#125;
&#125;</code></pre>
  </div>
  
  <button class="btn btn--small btn--copy-bibtex" onclick="copyBibtex()">
    <i class="fas fa-copy"></i> Copy BibTeX
  </button>
</section>

<script>
async function copyBibtex() {
  const bibtexText = document.querySelector('.bibtex-box code').textContent;
  const button = document.querySelector('.btn--copy-bibtex');
  const originalText = button.innerHTML;
  
  try {
    // Use modern Clipboard API
    await navigator.clipboard.writeText(bibtexText);
    
    // Show success feedback
    button.innerHTML = '<i class="fas fa-check"></i> Copied!';
    button.style.backgroundColor = '#62c462';
    
    setTimeout(() => {
      button.innerHTML = originalText;
      button.style.backgroundColor = '';
    }, 2000);
  } catch (err) {
    // Fallback for older browsers
    const textarea = document.createElement('textarea');
    textarea.value = bibtexText;
    textarea.style.position = 'fixed';
    textarea.style.opacity = '0';
    document.body.appendChild(textarea);
    textarea.select();
    
    try {
      document.execCommand('copy');
      button.innerHTML = '<i class="fas fa-check"></i> Copied!';
      button.style.backgroundColor = '#62c462';
      setTimeout(() => {
        button.innerHTML = originalText;
        button.style.backgroundColor = '';
      }, 2000);
    } catch (err) {
      button.innerHTML = '<i class="fas fa-times"></i> Failed';
      button.style.backgroundColor = '#e74c3c';
      setTimeout(() => {
        button.innerHTML = originalText;
        button.style.backgroundColor = '';
      }, 2000);
    }
    
    document.body.removeChild(textarea);
  }
}
</script>

